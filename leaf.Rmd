# Leaf {#cha:leaf}


```{r setup_leaf, message=FALSE, echo=FALSE, warning=FALSE}
library(knitr)
opts_chunk$set(
    cache = FALSE, echo = FALSE, 
    out.width = '80%', fig.asp = 1.2,
    warning = FALSE, fig.align = 'center',
    message = FALSE) 
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(xml2)
library(DiagrammeR)
source('_utility.R')
report <- read_csv('simulation/simulation.db.Report.csv')

df <- report %>% 
    filter(grepl('15TraitMod', Name),
           Management == 'IHN',
           Cultivar == 'hartog')

pmf <- read_xml('simulation/simulation.apsimx')


x_var <- c(
    'Wheat.Phenology.Stage',
    'Wheat.Phenology.AccumulateThermalTime')
x_lab <- 'Accumulated thermal time, stage'
```



Leaf cohort model is used in the ...

## Life growth cycle

In the leaf cohort model, the leaf growth cycle is divided into 7 stages.

```{r leaf-life-cycle, out.width='100%'}
library(DiagrammeR)
DiagrammeR("sequenceDiagram;
	Initialized->>Appeared: Appearance 
	Appeared->>Expanded: GrowthDuration
	Expanded->>Senescing: LagDuration
	Senescing->>Senesced: SenescenceDuration
	Senesced->>Detaching: DetachmentLagDuration
	Detaching->>Detached: DetachmentDuration
	Initialized->Expanded: IsGrowing
	Initialized->>Senesced: IsAlive
	Initialized->>Senesced: IsGreen
	Initialized->>Senescing: IsNotSenescing
	Senescing->>Senesced: IsSenescing
	Expanded->>Detached: IsFullyExpanded
	Senesced->>Detached: ShouldBeDead
	Senesced->>Detached: Finished
	Appeared->>Detached: IsAppeared
	Initialized->>Detached: IsInitialised
")
```

## Leaf initialization

A new leaf is initialized when the node number is increased by 1 at the main stem. Consequently, the total leaf cohort number is equal to total primordia number. The initialized rate of leaf cohort is equal to plastrochron.

<div class="fig-output">

```{r leaf-init-number, fig.cap='The primordia number in the main stem and initialised cohort number'}
y_cols <- c('Wheat.Structure.MainStemPrimordiaNo',
            'Wheat.Leaf.InitialisedCohortNo')

plot_report(df, x_var, y_cols, x_lab = x_lab, 
            y_lab = 'Number')

```
</div>



```{block, type='rmdimportant', echo=TRUE}
Actually, the total leaf primordia number is slightly less than the total cohort number.
```

## Leaf appearance 
Leaf appearance rate  

<div class="fig-output">

```{r leaf-appear-number, fig.cap='The node number in the main stem and appeared cohort number'}
y_cols <- c('Wheat.Structure.MainStemNodeNo',
            'Wheat.Leaf.AppearedCohortNo')

plot_report(df, x_var, y_cols, x_lab = x_lab, 
            y_lab = 'Number')

```
</div>




<div class="fig-output">
```{r leaf-cohort-number, fig.asp = 1.4, fig.cap='Initialized, appeared and expanding cohort number'}
y_cols <- c(
            'Wheat.Leaf.ExpandingCohortNo',
            'Wheat.Leaf.InitialisedCohortNo',
            'Wheat.Leaf.AppearedCohortNo',
            'Wheat.Leaf.SenescingCohortNo',
            'Wheat.Leaf.DeadCohortNo')

plot_report(df, x_var, y_cols, x_lab = x_lab, 
            y_lab = 'Cohort number')


```
</div>


## leaf age
- The leaf appearance rate equals to phyllochron which defined in Phenology parts.
- 

The age of leaf cohort is defined as the thermal time after appearance. 


<div class="fig-output">
```{r leaf-age, fig.cap='Age of leaf cohort as a function of stage or accumulated thermal time', fig.subcap=c('A', 'B')}
y_cols <- c(
    'Wheat.Leaf.CohortAge')
plot_report_vector(
    df, x_var, y_cols, x_lab = x_lab, 
    y_lab = 'Age of leaf cohort (oCd)')

```
</div>




<div class="fig-output">
```{r leaf-number, fig.asp = 1.3, fig.cap='Appeared number of green, senesced and total leaves'}
y_cols <- c(
    'Wheat.Leaf.PlantAppearedLeafNo',
    'Wheat.Leaf.PlantAppearedGreenLeafNo',
    'Wheat.Leaf.PlantsenescedLeafNo')

plot_report(df, x_var, y_cols, x_lab = x_lab, 
            y_lab = 'Leaf number')


```
</div>



## Leaf area index and coverage

<div class="fig-output">
```{r leaf-lai, fig.cap='Leaf area index', fig.subcap=c('Stage', 'Thermal time')}
y_cols <- c(
    'Wheat.Leaf.LAI', 
'Wheat.Leaf.LAIDead',
'Wheat.Leaf.LAITotal')
plot_report(df, x_var, y_cols, x_lab = x_lab, y_lab = 'Leaf area index')

```
</div>


<div class="fig-output">
```{r leaf-cover, fig.cap='Coverage', fig.subcap=c('Stage', 'Thermal time')}
y_cols <- c(
    'Wheat.Leaf.CoverGreen',
    'Wheat.Leaf.CoverDead',
    'Wheat.Leaf.CoverTotal')
plot_report(df, x_var, y_cols, x_lab = x_lab, y_lab = 'Coverage')

```
</div>





